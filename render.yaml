services:
  # ----------------------------------------------------------------------
  # 1. NestJS API (Serviço Web Público)
  # ----------------------------------------------------------------------
  - type: web
    name: api-desafio 
    runtime: docker
    plan: starter
    # Porta exposta pelo container (EXPOSE 4000 no Dockerfile)
    port: 4000 
    
    # NOVOS CAMPOS: Configuração de Build para Monorepo
    build:
      # Onde o Render deve procurar o código e o Dockerfile
      rootDir: backend-nestjs 
      # Opcional, mas útil para clareza
      dockerfilePath: backend-nestjs/Dockerfile
      
    env: production
    envVars:
      - key: MONGO_URI
        value: ${MONGO_DB_URL_ATLAS} 
      - key: NODE_ENV
        value: production
    
  # ----------------------------------------------------------------------
  # 2. Python Collector (Serviço de Background/Worker)
  # ----------------------------------------------------------------------
  - type: worker
    name: python-collector
    runtime: docker
    plan: starter
    
    # NOVOS CAMPOS: Configuração de Build para Monorepo
    build:
      rootDir: collector 
      dockerfilePath: collector/Dockerfile
      
    envVars:
      - key: REDIS_HOST
        value: red-d4ngtuadbo4c7391o7n0
      - key: REDIS_PORT
        value: 6379 
      - key: WEATHER_API_KEY
        value: ${WEATHER_API_KEY} 
      - key: CITY_NAME
        value: 'Toritama'
      
  # ----------------------------------------------------------------------
  # 3. Go Worker (Serviço de Background/Worker)
  # ----------------------------------------------------------------------
  - type: worker
    name: go-worker
    runtime: docker
    plan: starter

    # NOVOS CAMPOS: Configuração de Build para Monorepo
    build:
      rootDir: worker-go 
      dockerfilePath: worker-go/Dockerfile
      
    envVars:
      - key: REDIS_HOST
        value: red-d4ngtuadbo4c7391o7n0
      - key: REDIS_PORT
        value: 6379
      - key: NESTJS_API_URL
        value: http://api-desafio:4000/weather/logs
      # Variável secreta que deve ser definida no Painel
      - key: OUTRA_VAR_SECRETA
        value: ${OUTRA_VAR_SECRETA_VALUE}